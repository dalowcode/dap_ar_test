<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RozpoznÃ¡nÃ­ SPZ</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.0.2/tesseract.min.js"></script>
  <style>
    body { text-align: center; font-family: Arial, sans-serif; background: #222; color: #fff; }
    video { width: 100%; max-height: 400px; }
    #overlay { margin-top: 20px; background: rgba(0,0,0,0.6); padding: 15px; border-radius: 8px; display: inline-block; }
    canvas { display: none; }
  </style>
</head>
<body>
  <h1>RozpoznÃ¡nÃ­ SPZ ğŸš—</h1>
  <video id="camera" autoplay playsinline></video>
  <canvas id="canvas"></canvas>
  <div id="overlay"><h2>ğŸš˜ SPZ: NaÄÃ­tÃ¡nÃ­...</h2></div>

  <script>
    function isValidCZPlate(plate) {
        return /^[0-9][A-Z]{2}\s[0-9]{4}$/.test(plate); // OvÄ›Å™enÃ­ ÄeskÃ©ho formÃ¡tu SPZ
    }

    function isImageSharp(canvas) {
        const ctx = canvas.getContext("2d");
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const pixels = imageData.data;
        
        let sum = 0;
        for (let i = 0; i < pixels.length; i += 4) {
            sum += Math.abs(pixels[i] - pixels[i+4]); // ZmÄ›na mezi pixely
        }

        return sum > 50000; // PouÅ¾ijeme jen ostrÃ© obrÃ¡zky
    }

    function preprocessImage(canvas) {
        const ctx = canvas.getContext("2d");
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        // ğŸš— ZvÃ½Å¡enÃ­ kontrastu a pÅ™evod na ÄernobÃ­lÃ½ â†’ lepÅ¡Ã­ Äitelnost SPZ
        ctx.filter = "contrast(250%) grayscale(100%)"; 

        return canvas;
    }

    async function recognizePlate() {
        const canvas = preprocessImage(document.createElement("canvas"));

        if (!isImageSharp(canvas)) return "Obraz je rozmazanÃ½!";

        const { data } = await Tesseract.recognize(canvas, 'eng', {
            tessedit_char_whitelist: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'
        });

        let plate = data.text.trim().replace(/\s/g, '');

        // ğŸ”¥ **Filtrace neÅ¾Ã¡doucÃ­ch vedlejÅ¡Ã­ch textÅ¯**
        return isValidCZPlate(plate) ? plate : "NeplatnÃ¡ SPZ";
    }

    navigator.mediaDevices.getUserMedia({ video: { facingMode: { exact: "environment" } } })
        .then(stream => {
            document.getElementById('camera').srcObject = stream;
            setInterval(async () => {
                const plate = await recognizePlate();
                document.getElementById('overlay').innerHTML = `<h2>ğŸš˜ SPZ: ${plate}</h2>`;
            }, 5000);
        })
        .catch(err => alert("Nelze naÄÃ­st kameru: " + err));
  </script>
</body>
</html>


